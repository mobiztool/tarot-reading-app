# Test Design: Story 7.1 - Celtic Cross Spread (10 Cards)

**Story:** 7.1  
**Component:** Celtic Cross Premium Spread  
**QA Engineer:** Quinn (Test Architect)  
**Date:** 2026-01-13  
**Risk Level:** HIGH (Flagship premium feature - most complex spread)

---

## 1. Test Strategy

### Test Levels
- **Unit Tests** (40%): Position calculations, card selection logic
- **Component Tests** (30%): Layout rendering, animations
- **Integration Tests** (20%): API, database, premium access
- **E2E Tests** (10%): Complete reading flow

### Focus Areas
- **10-card layout complexity** (Cross + Staff formation)
- **Premium access control** (Pro/VIP only)
- **Sequential animations** (10 cards staggered)
- **Position-specific interpretations** (10 unique contexts)
- **Mobile responsiveness** (complex layout → simple stack)

---

## 2. Test Scenarios

### Scenario 1: Premium Access Control (P0)
**Given-When-Then:**
- **Given** user is FREE tier (no subscription)
- **When** navigates to /reading/celtic-cross
- **Then** premium gate displays
- **And** shows "Upgrade to Pro/VIP" message
- **And** redirects to pricing page on CTA click

**Test Cases:**
- TC-7.1-001: FREE user → premium gate shown
- TC-7.1-002: Guest user (not logged in) → login prompt
- TC-7.1-003: BASIC user → premium gate shown (celtic_cross requires Pro+)
- TC-7.1-004: PRO user → access granted, page loads
- TC-7.1-005: VIP user → access granted, page loads
- TC-7.1-006: Canceled subscription in grace period → access granted
- TC-7.1-007: Canceled subscription after period end → premium gate

**Priority:** P0 (Revenue protection)

---

### Scenario 2: 10-Card Layout - Cross Formation (P0)
**Given-When-Then:**
- **Given** PRO user on Celtic Cross page
- **When** page loads
- **Then** 6 cards display in cross formation:
  - Position 1 (Present) - Center
  - Position 2 (Challenge) - Center overlay/crossed
  - Position 3 (Past) - Left of center
  - Position 4 (Future) - Right of center
  - Position 5 (Above) - Top of center
  - Position 6 (Below) - Bottom of center

**Test Cases:**
- TC-7.1-010: Cross formation 6 cards positioned correctly
- TC-7.1-011: Position 2 overlay/crossed appearance
- TC-7.1-012: Symmetrical layout (balanced cross)
- TC-7.1-013: Card spacing appropriate (not overlapping except #2)
- TC-7.1-014: Card size consistent in cross
- TC-7.1-015: Hover states on each card in cross

**Priority:** P0 (Core UX)

---

### Scenario 3: 10-Card Layout - Staff Formation (P0)
**Given-When-Then:**
- **Given** PRO user viewing Celtic Cross
- **When** viewing right side of layout
- **Then** 4 cards display in vertical staff:
  - Position 7 (Advice) - Bottom right
  - Position 8 (External) - Mid-right
  - Position 9 (Hopes/Fears) - Upper-mid-right
  - Position 10 (Outcome) - Top right

**Test Cases:**
- TC-7.1-020: Staff formation 4 cards vertical alignment
- TC-7.1-021: Staff positioned right of cross
- TC-7.1-022: Vertical spacing equal between cards
- TC-7.1-023: Card order correct (7→8→9→10 bottom to top)
- TC-7.1-024: Staff height aligned with cross height

**Priority:** P0 (Core UX)

---

### Scenario 4: Sequential Card Animation (P1)
**Given-When-Then:**
- **Given** user clicks "Draw Cards"
- **When** drawing starts
- **Then** cards reveal in sequence:
  1. Position 1 (Present)
  2. Position 2 (Challenge) 
  3. Position 3 (Past)
  4. Position 4 (Future)
  5. Position 5 (Above)
  6. Position 6 (Below)
  7. Position 7 (Advice)
  8. Position 8 (External)
  9. Position 9 (Hopes/Fears)
  10. Position 10 (Outcome)
- **And** each card has 0.3s delay (staggered)

**Test Cases:**
- TC-7.1-030: Cards reveal in correct order (1→10)
- TC-7.1-031: Stagger delay 0.3s between each card
- TC-7.1-032: Flip animation smooth (not janky)
- TC-7.1-033: Total animation ~3 seconds (0.3s × 10)
- TC-7.1-034: Loading state shown during animation
- TC-7.1-035: Animation can be skipped (optional)
- TC-7.1-036: No animation glitches with 10 cards

**Priority:** P1 (Polish)

---

### Scenario 5: Card Drawing Logic (P0)
**Given-When-Then:**
- **Given** Celtic Cross page loaded
- **When** user draws cards
- **Then** 10 unique cards selected
- **And** no duplicate cards
- **And** each card has is_reversed status

**Test Cases:**
- TC-7.1-040: Exactly 10 cards drawn
- TC-7.1-041: All 10 cards unique (no duplicates)
- TC-7.1-042: Cards randomly selected from 78-card deck
- TC-7.1-043: Reversed status randomly assigned (50/50)
- TC-7.1-044: Same cards can be drawn again on refresh
- TC-7.1-045: Card IDs valid (exist in database)

**Priority:** P0 (Core functionality)

---

### Scenario 6: Position-Specific Interpretations (P0)
**Given-When-Then:**
- **Given** 10 cards drawn
- **When** viewing interpretation section
- **Then** each position shows:
  - Position name (e.g., "Present Situation")
  - Card name and image
  - Position-specific context
  - Upright/Reversed interpretation

**Test Cases:**
- TC-7.1-050: Position 1 interpretation includes "present situation" context
- TC-7.1-051: Position 2 interpretation includes "challenge/obstacle" context
- TC-7.1-052: Position 3 interpretation includes "past influences" context
- TC-7.1-053: Position 4 interpretation includes "future potential" context
- TC-7.1-054: Position 5 interpretation includes "conscious thoughts" context
- TC-7.1-055: Position 6 interpretation includes "subconscious" context
- TC-7.1-056: Position 7 interpretation includes "advice/approach" context
- TC-7.1-057: Position 8 interpretation includes "external influences" context
- TC-7.1-058: Position 9 interpretation includes "hopes and fears" context
- TC-7.1-059: Position 10 interpretation includes "final outcome" context
- TC-7.1-060: All 10 interpretations displayed correctly

**Priority:** P0 (Core value)

---

### Scenario 7: Combined Reading Summary (P1)
**Given-When-Then:**
- **Given** all 10 cards interpreted
- **When** viewing summary section
- **Then** comprehensive summary shown
- **And** synthesizes all 10 positions
- **And** provides holistic reading

**Test Cases:**
- TC-7.1-070: Summary section displays after interpretations
- TC-7.1-071: Summary references multiple positions
- TC-7.1-072: Summary length appropriate (200-400 words)
- TC-7.1-073: Summary in Thai language
- TC-7.1-074: Summary considers reversed cards

**Priority:** P1 (Premium value)

---

### Scenario 8: Save Reading (P0)
**Given-When-Then:**
- **Given** Celtic Cross reading complete
- **When** saved to database
- **Then** reading_type = "celtic_cross"
- **And** all 10 cards saved with positions
- **And** user can view in history

**Test Cases:**
- TC-7.1-080: Reading saved with correct type
- TC-7.1-081: All 10 cards saved to reading_cards table
- TC-7.1-082: Position numbers 1-10 saved correctly
- TC-7.1-083: is_reversed status preserved
- TC-7.1-084: Reading appears in user history
- TC-7.1-085: Can reload saved reading
- TC-7.1-086: Question text saved (if provided)

**Priority:** P0 (Data persistence)

---

### Scenario 9: Mobile Responsive Layout (P0)
**Given-When-Then:**
- **Given** mobile device (< 768px width)
- **When** viewing Celtic Cross
- **Then** layout switches to vertical stack
- **And** clear position labels shown
- **And** cards full width

**Test Cases:**
- TC-7.1-090: Desktop → cross + staff layout
- TC-7.1-091: Mobile → vertical stack layout
- TC-7.1-092: Position labels clearly visible on mobile
- TC-7.1-093: Cards readable size on mobile
- TC-7.1-094: Scroll smooth on mobile (10 cards)
- TC-7.1-095: Touch interactions work on mobile
- TC-7.1-096: Animation performs well on mobile
- TC-7.1-097: Responsive breakpoint at 768px

**Priority:** P0 (Mobile UX)

---

### Scenario 10: Performance with 10 Cards (P1)
**Given-When-Then:**
- **Given** Celtic Cross page with 10 cards
- **When** measuring performance
- **Then** page load < 2s
- **And** card rendering < 500ms
- **And** animations smooth (60fps)

**Test Cases:**
- TC-7.1-100: Initial page load < 2 seconds
- TC-7.1-101: 10 card images load progressively
- TC-7.1-102: No layout shift during load
- TC-7.1-103: Animation frame rate 60fps
- TC-7.1-104: Memory usage reasonable with 10 cards
- TC-7.1-105: No performance degradation on older devices

**Priority:** P1 (Performance)

---

## 3. Integration Test Scenarios

### Scenario 11: API - Draw 10 Cards (P0)
**Given-When-Then:**
- **Given** authenticated PRO user
- **When** POST /api/readings/draw with count=10, type="celtic_cross"
- **Then** returns 10 unique cards
- **And** saves to database

**Test Cases:**
- TC-7.1-110: API accepts count=10 parameter
- TC-7.1-111: Returns exactly 10 cards
- TC-7.1-112: All cards unique (no duplicates)
- TC-7.1-113: Saves reading to database
- TC-7.1-114: Returns 201 Created status
- TC-7.1-115: Response includes reading ID

**Priority:** P0

---

### Scenario 12: Database Schema Support (P0)
**Given-When-Then:**
- **Given** ReadingType enum
- **When** checking schema
- **Then** "celtic_cross" value exists
- **And** supports 10 cards in reading_cards

**Test Cases:**
- TC-7.1-120: ReadingType enum includes celtic_cross
- TC-7.1-121: reading_cards table supports position 1-10
- TC-7.1-122: No constraint violations with 10 cards
- TC-7.1-123: Foreign key relationships intact

**Priority:** P0

---

## 4. E2E Test Scenarios

### Scenario 13: Complete Celtic Cross Flow (P0)
**Steps:**
1. Login as PRO user
2. Navigate to /reading/celtic-cross
3. Enter question (optional)
4. Click "Draw Cards"
5. Watch 10-card animation
6. View all 10 interpretations
7. Read combined summary
8. Save reading
9. View in history
10. Verify all data correct

**Priority:** P0

---

### Scenario 14: Premium Gate Conversion (P1)
**Steps:**
1. Login as FREE user
2. Navigate to /reading/celtic-cross
3. See premium gate
4. Click "Upgrade to Pro"
5. Complete payment
6. Return to Celtic Cross
7. Access granted
8. Successfully draw 10 cards

**Priority:** P1

---

## 5. Test Data Requirements

### Premium Users
```javascript
{
  pro_user: { tier: "pro", subscription: "active" },
  vip_user: { tier: "vip", subscription: "active" },
  free_user: { tier: "free" },
  basic_user: { tier: "basic", subscription: "active" },
}
```

### Card Deck
```javascript
{
  total_cards: 78,
  major_arcana: 22,
  minor_arcana: 56,
  // All cards must be available for selection
}
```

### Celtic Cross Positions
```javascript
{
  positions: [
    { id: 1, name: "Present Situation", nameTh: "สถานการณ์ปัจจุบัน" },
    { id: 2, name: "Challenge", nameTh: "อุปสรรค" },
    { id: 3, name: "Past", nameTh: "อดีต" },
    { id: 4, name: "Future", nameTh: "อนาคต" },
    { id: 5, name: "Above (Conscious)", nameTh: "จิตสำนึก" },
    { id: 6, name: "Below (Subconscious)", nameTh: "จิตใต้สำนึก" },
    { id: 7, name: "Advice", nameTh: "คำแนะนำ" },
    { id: 8, name: "External Influences", nameTh: "อิทธิพลภายนอก" },
    { id: 9, name: "Hopes and Fears", nameTh: "ความหวังและความกลัว" },
    { id: 10, name: "Outcome", nameTh: "ผลลัพธ์สุดท้าย" },
  ]
}
```

---

## 6. Risk Coverage Matrix

| Risk | Severity | Test Coverage | Mitigation |
|------|----------|---------------|------------|
| Unauthorized access | HIGH | TC-7.1-001-007 | P0 access control tests |
| Layout breaks with 10 cards | MEDIUM | TC-7.1-010-024 | P0 layout tests |
| Duplicate cards drawn | HIGH | TC-7.1-040-045 | P0 uniqueness tests |
| Poor mobile experience | MEDIUM | TC-7.1-090-097 | P0 responsive tests |
| Performance issues | MEDIUM | TC-7.1-100-105 | P1 performance tests |
| Animation janky | LOW | TC-7.1-030-036 | P1 animation tests |

---

## 7. Test Execution Plan

### Phase 1: Access Control (Day 1)
- Implement TC-7.1-001 to TC-7.1-007
- Verify premium gating works
- Tools: Vitest, mock auth

### Phase 2: Layout & Rendering (Day 2)
- Implement TC-7.1-010 to TC-7.1-024
- Test both formations (cross + staff)
- Tools: React Testing Library, Playwright

### Phase 3: Card Logic (Day 2-3)
- Implement TC-7.1-040 to TC-7.1-060
- Test drawing, interpretations
- Tools: Vitest, test database

### Phase 4: Integration & E2E (Day 3-4)
- Implement Scenarios 11-14
- Complete flow testing
- Tools: Playwright, test Stripe account

---

## 8. Success Criteria

✅ **Access Control:**
- [ ] Premium gating works for all tier combinations
- [ ] No unauthorized access

✅ **Layout:**
- [ ] Cross + Staff formation correct on desktop
- [ ] Vertical stack works on mobile
- [ ] All 10 positions clearly labeled

✅ **Functionality:**
- [ ] 10 unique cards drawn
- [ ] All interpretations accurate
- [ ] Reading saves correctly

✅ **Performance:**
- [ ] Page loads < 2s
- [ ] Animations smooth
- [ ] Mobile responsive

✅ **Overall:**
- [ ] All P0 tests passing
- [ ] Code coverage >85%
- [ ] QA sign-off obtained

---

**Next Steps:**
1. Review test design with team
2. Set up test environment
3. Implement access control tests first (P0)
4. Implement layout tests (P0)
5. Implement integration tests
6. Run E2E tests
7. Performance testing
8. Final QA approval

**Estimated Effort:** 4-5 days for complete test implementation

**Dependencies:**
- Story 7.5 (Premium Spread Layouts) - layout components
- Story 7.6 (Premium Content Creation) - position interpretations
- Epic 6 (Payment System) - tier checking
