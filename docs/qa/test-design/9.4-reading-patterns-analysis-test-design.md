# Test Design: Story 9.4 - Reading Patterns Analysis (VIP Feature)

**Story:** 9.4  
**Component:** Personal Reading Pattern Analysis & Insights  
**QA Engineer:** Quinn (Test Architect)  
**Date:** 2026-01-13  
**Risk Level:** MEDIUM (Algorithm accuracy, data analysis)

---

## 1. Test Strategy

### Test Levels
- **Unit Tests** (60%): Pattern detection algorithms
- **Integration Tests** (30%): Database queries, data aggregation
- **E2E Tests** (10%): User views patterns

### Focus Areas
- **Pattern detection accuracy** (frequent cards, themes, timing)
- **Data visualization** (charts, graphs)
- **Minimum data requirements** (need history to analyze)
- **VIP-only access**
- **Privacy** (user's personal reading history)

---

## 2. Test Scenarios

### Scenario 1: VIP-Only Access Control (P0)
**Given-When-Then:**
- **Given** user is Pro tier
- **When** navigates to /profile/patterns
- **Then** VIP gate displays
- **And** shows pattern analysis benefits

**Test Cases:**
- TC-9.4-001: FREE/BASIC/PRO users → VIP gate
- TC-9.4-002: VIP users → access granted
- TC-9.4-003: Feature clearly labeled "VIP Exclusive"

**Priority:** P0

---

### Scenario 2: Minimum Data Requirements (P0)
**Given-When-Then:**
- **Given** VIP user with reading history
- **When** accessing patterns
- **Then** requires minimum readings (e.g., 10)
- **And** shows message if insufficient

**Test Cases:**
- TC-9.4-010: < 10 readings → "Need more readings" message
- TC-9.4-011: >= 10 readings → analysis shown
- TC-9.4-012: Clear message explains minimum needed
- TC-9.4-013: Encourages creating more readings

**Priority:** P0

---

### Scenario 3: Frequent Cards Detection (P1)
**Given-When-Then:**
- **Given** user has 20+ readings
- **When** analyzing card frequency
- **Then** identifies most common cards
- **And** shows percentage/count

**Test Cases:**
- TC-9.4-020: Algorithm counts card appearances accurately
- TC-9.4-021: Top 5 most frequent cards identified
- TC-9.4-022: Percentage calculated correctly
- TC-9.4-023: Both upright and reversed counted
- TC-9.4-024: Visualized as chart/graph
- TC-9.4-025: Interpretation of frequent cards provided

**Priority:** P1

---

### Scenario 4: Theme Detection (P1)
**Given-When-Then:**
- **Given** user's reading questions
- **When** analyzing themes
- **Then** identifies recurring topics:
  - Love/Relationships
  - Career/Money
  - Personal Growth
  - Spiritual

**Test Cases:**
- TC-9.4-030: Keyword extraction from questions
- TC-9.4-031: Theme categorization accurate
- TC-9.4-032: Top 3 themes identified
- TC-9.4-033: Percentage per theme calculated
- TC-9.4-034: Thai keywords detected
- TC-9.4-035: Visualization clear

**Priority:** P1

---

### Scenario 5: Time Pattern Analysis (P2)
**Given-When-Then:**
- **Given** readings with timestamps
- **When** analyzing temporal patterns
- **Then** identifies:
  - Most active time of day
  - Most active day of week
  - Reading frequency trends

**Test Cases:**
- TC-9.4-040: Time-of-day patterns detected
- TC-9.4-041: Day-of-week patterns detected
- TC-9.4-042: Monthly frequency calculated
- TC-9.4-043: Trends visualized (line chart)
- TC-9.4-044: Insights provided (e.g., "You read most at night")

**Priority:** P2 (Nice insight)

---

### Scenario 6: Spread Preferences (P1)
**Given-When-Then:**
- **Given** user has tried multiple spreads
- **When** analyzing spread usage
- **Then** identifies favorite spreads
- **And** shows usage distribution

**Test Cases:**
- TC-9.4-050: Count readings per spread type
- TC-9.4-051: Top 3 favorite spreads identified
- TC-9.4-052: Percentage per spread calculated
- TC-9.4-053: Suggests trying unused spreads

**Priority:** P1

---

### Scenario 7: Pattern Visualization (P1)
**Given-When-Then:**
- **Given** pattern analysis data
- **When** displaying to user
- **Then** charts/graphs clear and interactive

**Test Cases:**
- TC-9.4-060: Bar chart for frequent cards
- TC-9.4-061: Pie chart for theme distribution
- TC-9.4-062: Line chart for reading frequency
- TC-9.4-063: Charts responsive (mobile/desktop)
- TC-9.4-064: Interactive hover states
- TC-9.4-065: Thai labels on charts
- TC-9.4-066: Color-blind friendly colors

**Priority:** P1

---

### Scenario 8: Personalized Insights (P1)
**Given-When-Then:**
- **Given** pattern analysis complete
- **When** generating insights
- **Then** provides personalized observations:
  - "You often draw The Fool - embrace new beginnings"
  - "Your focus is love - consider career spreads too"
  - "You read most at night - moon phase influence?"

**Test Cases:**
- TC-9.4-070: Insights based on actual patterns
- TC-9.4-071: 3-5 insights provided
- TC-9.4-072: Thai language natural
- TC-9.4-073: Actionable suggestions included
- TC-9.4-074: Tone supportive (not judgmental)

**Priority:** P1

---

### Scenario 9: Algorithm Accuracy (P0)
**Given-When-Then:**
- **Given** test user with known reading history
- **When** running pattern analysis
- **Then** results match expected patterns
- **And** calculations accurate

**Test Cases:**
- TC-9.4-080: Algorithm tested with synthetic data
- TC-9.4-081: Known patterns detected correctly
- TC-9.4-082: Calculations verified (counts, percentages)
- TC-9.4-083: Edge cases handled (ties, zero readings in category)
- TC-9.4-084: Performance acceptable (< 2s analysis)

**Priority:** P0

---

## 3. Integration Test Scenarios

### Scenario 10: Database Query Optimization (P1)
**Test Cases:**
- TC-9.4-090: Query user readings efficiently
- TC-9.4-091: Aggregations performant
- TC-9.4-092: No N+1 query issues
- TC-9.4-093: Results cached (optional)

**Priority:** P1

---

### Scenario 11: API Integration (P1)
**Test Cases:**
- TC-9.4-100: GET /api/patterns/analyze endpoint
- TC-9.4-101: VIP tier validated
- TC-9.4-102: Returns pattern analysis data
- TC-9.4-103: Response time < 2s

**Priority:** P1

---

## 4. E2E Test Scenarios

### Scenario 12: Complete Pattern Analysis Flow (P0)
**Steps:**
1. Login as VIP user (with 20+ readings)
2. Navigate to /profile/patterns
3. View pattern analysis loading
4. See frequent cards chart
5. View theme distribution
6. Read personalized insights
7. Explore visualizations
8. Click on card → see all readings with that card
9. Verify insights helpful

**Priority:** P0

---

### Scenario 13: Insufficient Data Flow (P1)
**Steps:**
1. Login as VIP user (with < 10 readings)
2. Navigate to patterns
3. See "Need more readings" message
4. Click "Create Reading" CTA
5. Complete reading
6. Return to patterns (still need more)

**Priority:** P1

---

## 5. Test Data Requirements

### Test Users
```javascript
{
  vip_new: { readings: 5, patterns: "insufficient" },
  vip_moderate: { readings: 20, patterns: "basic analysis" },
  vip_heavy: { readings: 100, patterns: "rich insights" },
}
```

### Synthetic Reading Data
```javascript
{
  // User with clear pattern (for testing)
  pattern_user: {
    readings: 30,
    frequent_cards: ["The Fool", "The Lovers", "The Star"],
    themes: ["love" (60%), "career" (30%), "spiritual" (10%)],
    time_of_day: "night" (70%),
    favorite_spread: "three_card" (50%),
  }
}
```

---

## 6. Success Criteria

✅ **Algorithm Accuracy:**
- [ ] Pattern detection accurate (verified with test data)
- [ ] Calculations correct (counts, percentages)
- [ ] Insights meaningful

✅ **Visualization:**
- [ ] Charts clear and informative
- [ ] Data correctly represented
- [ ] Interactive elements work
- [ ] Mobile responsive

✅ **VIP Feature:**
- [ ] Only VIP can access
- [ ] Provides unique value
- [ ] Encourages VIP subscriptions

✅ **Privacy:**
- [ ] User data private
- [ ] Cannot view other users' patterns
- [ ] Secure data handling

✅ **Overall:**
- [ ] All P0 tests passing
- [ ] Code coverage >85%
- [ ] User finds insights valuable

---

**Estimated Effort:** 3-4 days

**Dependencies:**
- Sufficient user reading history (need 10+ readings)
- Chart library (Chart.js, Recharts, etc.)
- Pattern detection algorithm design
