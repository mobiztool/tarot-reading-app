# Test Design: Story 9.3 - Reading Export to PDF (Pro/VIP Feature)

**Story:** 9.3  
**Component:** PDF Export of Tarot Readings  
**QA Engineer:** Quinn (Test Architect)  
**Date:** 2026-01-13  
**Risk Level:** HIGH (Thai font rendering critical!)

---

## 1. Test Strategy

### Test Levels
- **Unit Tests** (30%): PDF generation logic
- **Integration Tests** (40%): PDF library, font embedding
- **Manual QA** (20%): Visual review on all platforms
- **E2E Tests** (10%): Download and open flow

### Focus Areas
- **Thai font rendering** (CRITICAL - no □□□ characters)
- **PDF library integration** (jsPDF, PDFKit, or similar)
- **Multi-platform support** (Windows, Mac, iOS, Android)
- **Pro/VIP access** control
- **Professional appearance**

---

## 2. Test Scenarios

### Scenario 1: PDF Generation Works (P0)
**Given-When-Then:**
- **Given** completed reading (any type)
- **When** user clicks "Export to PDF"
- **Then** PDF generates successfully
- **And** downloads to device

**Test Cases:**
- TC-9.3-001: PDF generation completes without errors
- TC-9.3-002: File downloads successfully
- TC-9.3-003: Filename meaningful (e.g., "tarot-reading-2026-01-13.pdf")
- TC-9.3-004: File size reasonable (< 5MB)
- TC-9.3-005: Generation time < 3 seconds
- TC-9.3-006: Works on desktop and mobile

**Priority:** P0

---

### Scenario 2: Thai Font Rendering (P0) - CRITICAL!
**Given-When-Then:**
- **Given** PDF with Thai content
- **When** opening PDF on any device
- **Then** Thai characters display perfectly
- **And** no missing glyphs (□□□)
- **And** font readable and professional

**Test Cases:**
- TC-9.3-010: Thai font embedded in PDF ✓
- TC-9.3-011: All Thai characters render (ก-ฮ, vowels, tone marks)
- TC-9.3-012: No font fallback issues
- TC-9.3-013: Font license allows commercial embedding
- TC-9.3-014: **Test on Windows** (Adobe Reader, Edge)
- TC-9.3-015: **Test on Mac** (Preview, Safari)
- TC-9.3-016: **Test on iOS** (Files app, Safari)
- TC-9.3-017: **Test on Android** (Google Drive, Chrome)
- TC-9.3-018: Font weight/style correct (not too thin/thick)
- TC-9.3-019: Line height appropriate for Thai
- TC-9.3-020: No character overlap or spacing issues

**Priority:** P0 (BLOCKING - Thai UX critical!)

---

### Scenario 3: PDF Content Completeness (P0)
**Given-When-Then:**
- **Given** reading with all data
- **When** exported to PDF
- **Then** PDF includes:
  - User's question
  - All card images
  - Card names (Thai + English)
  - Position labels
  - All interpretations
  - Reading date
  - Spread type

**Test Cases:**
- TC-9.3-030: User question included
- TC-9.3-031: All card images embedded (high quality)
- TC-9.3-032: Card names in Thai
- TC-9.3-033: Position labels clear
- TC-9.3-034: All interpretations included (full text)
- TC-9.3-035: Reading metadata (date, spread type)
- TC-9.3-036: Nothing missing from original reading
- TC-9.3-037: Layout professional (not cramped)

**Priority:** P0

---

### Scenario 4: PDF Visual Quality (P1)
**Given-When-Then:**
- **Given** exported PDF
- **When** reviewing appearance
- **Then** professional design
- **And** print-ready quality

**Test Cases:**
- TC-9.3-040: Professional layout and design
- TC-9.3-041: Images high resolution (not pixelated)
- TC-9.3-042: Text readable (font size 10-12pt)
- TC-9.3-043: Colors print well (if user prints)
- TC-9.3-044: Margins appropriate
- TC-9.3-045: Multi-page layout if needed (long readings)
- TC-9.3-046: Page breaks logical (not mid-card)
- TC-9.3-047: Branding/logo included (optional)

**Priority:** P1 (Quality)

---

### Scenario 5: PDF Library Integration (P0)
**Given-When-Then:**
- **Given** PDF library (e.g., jsPDF, react-pdf, PDFKit)
- **When** integrating into app
- **Then** library supports requirements:
  - Thai font embedding
  - Image embedding
  - Multi-page support
  - Client-side or server-side generation

**Test Cases:**
- TC-9.3-050: PDF library installed and configured
- TC-9.3-051: Thai font file added to project
- TC-9.3-052: Font registered with library
- TC-9.3-053: Image embedding works
- TC-9.3-054: Performance acceptable (< 3s)
- TC-9.3-055: Memory usage reasonable
- TC-9.3-056: No library conflicts

**Priority:** P0 (Technical foundation)

---

### Scenario 6: Pro/VIP Access Control (P0)
**Given-When-Then:**
- **Given** PDF export feature
- **When** checking access
- **Then** FREE/BASIC users cannot export
- **And** Pro/VIP users can export

**Test Cases:**
- TC-9.3-060: FREE users → export button locked/hidden
- TC-9.3-061: BASIC users → export button locked/hidden
- TC-9.3-062: PRO users → can export to PDF ✓
- TC-9.3-063: VIP users → can export to PDF ✓
- TC-9.3-064: Gate shows "Upgrade to Pro" for Basic
- TC-9.3-065: Export button clearly labeled with tier badge

**Priority:** P0

---

### Scenario 7: Error Handling (P0)
**Given-When-Then:**
- **Given** PDF generation
- **When** error occurs
- **Then** graceful error handling
- **And** user can retry

**Test Cases:**
- TC-9.3-070: Generation fails → error message shown
- TC-9.3-071: Retry button available
- TC-9.3-072: Error logged to Sentry
- TC-9.3-073: Thai error message shown
- TC-9.3-074: Font missing → error handled
- TC-9.3-075: Image missing → placeholder or error

**Priority:** P0

---

### Scenario 8: Different Spread Types (P0)
**Given-When-Then:**
- **Given** various spread types
- **When** exporting to PDF
- **Then** all types supported:
  - Simple (1-3 cards)
  - Medium (5-7 cards)
  - Complex (10-13 cards)

**Test Cases:**
- TC-9.3-080: Daily reading (1 card) → PDF works
- TC-9.3-081: Celtic Cross (10 cards) → PDF works
- TC-9.3-082: Year Ahead (13 cards) → PDF multi-page
- TC-9.3-083: All 18 spread types supported
- TC-9.3-084: Layout adapts to card count

**Priority:** P0

---

## 3. Manual QA Scenarios

### Scenario 9: Cross-Platform Visual QA (P0)
**Manual Testing Checklist:**

**Windows:**
- [ ] Adobe Reader: Thai renders ✓
- [ ] Edge PDF viewer: Thai renders ✓
- [ ] Chrome PDF viewer: Thai renders ✓

**Mac:**
- [ ] Preview: Thai renders ✓
- [ ] Safari PDF viewer: Thai renders ✓

**iOS:**
- [ ] Files app: Thai renders ✓
- [ ] Safari: Thai renders ✓
- [ ] Third-party apps (optional)

**Android:**
- [ ] Google Drive: Thai renders ✓
- [ ] Chrome: Thai renders ✓
- [ ] Adobe Reader mobile: Thai renders ✓

**Linux (optional):**
- [ ] Evince: Thai renders ✓
- [ ] Firefox: Thai renders ✓

**Priority:** P0 (MUST TEST ALL)

---

### Scenario 10: Print Quality (P1)
**Manual Testing:**
- [ ] Print PDF on physical printer
- [ ] Thai text prints correctly
- [ ] Images print clearly
- [ ] Colors acceptable (black & white OK)
- [ ] Margins don't cut off content

**Priority:** P1

---

## 4. Integration Test Scenarios

### Scenario 11: Save PDF Metadata (P1)
**Test Cases:**
- TC-9.3-100: Track PDF exports in analytics
- TC-9.3-101: Count exports per user
- TC-9.3-102: Popular export spreads tracked

**Priority:** P1

---

## 5. E2E Test Scenarios

### Scenario 12: Complete Export Flow (P0)
**Steps:**
1. Login as Pro user
2. Complete reading (e.g., Three Card)
3. Click "Export to PDF" button
4. Wait for generation (~2s)
5. PDF downloads
6. Open PDF
7. Verify all content present
8. Verify Thai renders perfectly
9. Close PDF
10. Export again (should be fast - cached)

**Priority:** P0

---

## 6. Risk Coverage Matrix

| Risk | Severity | Test Coverage | Mitigation |
|------|----------|---------------|------------|
| Thai fonts broken (□□□) | CRITICAL | TC-9.3-010-020 | Multi-platform testing |
| PDF generation fails | HIGH | TC-9.3-070-075 | Error handling, retry |
| Poor visual quality | MEDIUM | TC-9.3-040-047 | Manual QA review |
| Unauthorized access | HIGH | TC-9.3-060-065 | Pro/VIP validation |

---

## 7. Test Execution Plan

### Phase 1: PDF Library Setup (Day 1)
- Choose and configure library
- Embed Thai font
- Basic generation test

### Phase 2: Thai Font Testing (Day 2-3)
- Test on all platforms (CRITICAL)
- Fix any rendering issues
- Verify font license

### Phase 3: Content & Layout (Day 3-4)
- All content included
- Professional appearance
- Multi-card layouts

### Phase 4: Integration & E2E (Day 4-5)
- API integration
- Access control
- Complete user flow

---

## 8. Success Criteria

✅ **Thai Font Perfect:**
- [ ] Thai renders on ALL platforms tested
- [ ] Zero □□□ missing characters
- [ ] Native speakers approve appearance

✅ **Content Complete:**
- [ ] All reading data in PDF
- [ ] Professional layout
- [ ] Print-ready quality

✅ **Access Control:**
- [ ] Pro/VIP only
- [ ] FREE/BASIC locked
- [ ] Clear upgrade prompt

✅ **Reliability:**
- [ ] Generation success rate >99%
- [ ] Error handling works
- [ ] Performance acceptable

---

**Estimated Effort:** 4-5 days

**CRITICAL:** Thai font testing cannot be skipped! Test on 8+ platform/app combinations

**Dependencies:**
- PDF library selection
- Thai font license
- Design template for PDF layout
