# Risk Profile: Story 7.1 - Celtic Cross Spread (10 Cards)

**Story:** 7.1  
**Date:** 2026-01-13  
**Reviewer:** Quinn (Test Architect)  
**Status:** Ready for Review

---

## Executive Summary

- **Total Risks Identified:** 12
- **Critical Risks (Score 9):** 2
- **High Risks (Score 6):** 3
- **Medium Risks (Score 4):** 5
- **Low Risks (Score 2-3):** 2
- **Overall Risk Score:** 45/100 (HIGH RISK - flagship premium feature)

---

## Critical Risks Requiring Immediate Attention

### 1. SEC-001: Unauthorized Premium Access Bypass

**Score: 9 (Critical)**  
**Probability:** High (3) - Complex access control logic, easy to miss edge cases  
**Impact:** High (3) - Revenue loss, free access to paid content

**Description:**
Celtic Cross requires Pro/VIP tier. Risk of bypass through:
- Client-side check only (no server validation)
- Grace period logic bugs
- Tier caching issues
- Direct URL access without gate

**Affected Components:**
- `/reading/celtic-cross/page.tsx`
- `lib/access-control/spreads.ts`
- Premium gate component

**Mitigation:**
- ✅ Implement server-side tier checking in middleware
- ✅ Validate access on API route (double check)
- ✅ Add comprehensive access control tests (TC-7.1-001 to TC-7.1-007)
- ✅ Security audit before launch
- ✅ Monitor unauthorized access attempts

**Testing Focus:**
- Unit tests: canAccessSpread() all tier combinations
- Integration tests: API endpoint authorization
- E2E tests: Attempt bypass with different tiers
- Penetration testing: Try to access without subscription

**Residual Risk:** LOW - After mitigation and testing

**Owner:** Dev + QA  
**Timeline:** Before Story 7.9 (testing phase)

---

### 2. TECH-001: 10-Card Layout Breaks on Devices

**Score: 9 (Critical)**  
**Probability:** High (3) - Most complex layout, many device variations  
**Impact:** High (3) - Poor UX, app unusable, reputation damage

**Description:**
Celtic Cross has 10 cards in complex cross + staff formation. Risk of:
- Layout overflow on small screens
- Card overlap on tablets
- Animation janking with 10 cards
- Memory issues on older devices
- CSS positioning bugs

**Affected Components:**
- `SpreadLayout` component (Story 7.5)
- Celtic Cross page layout
- Card animation system

**Mitigation:**
- ✅ Implement responsive design (desktop → mobile stack)
- ✅ Test on 10+ device/browser combinations (Story 7.9)
- ✅ Progressive enhancement (fallback for old devices)
- ✅ Performance testing with 10 cards
- ✅ Visual regression testing

**Testing Focus:**
- Component tests: Layout at all breakpoints
- Device tests: iPhone, Samsung, iPad, various Android
- Performance tests: Animation frame rate, memory usage
- Visual tests: Screenshot comparison baselines

**Residual Risk:** LOW - After comprehensive device testing

**Owner:** Dev + QA  
**Timeline:** Story 7.5 completion + Story 7.9 device testing

---

## High Risks

### 3. PERF-001: Performance Degradation with 10 Cards

**Score: 6 (High)**  
**Probability:** Medium (2) - 10 cards = 10 images + animations  
**Impact:** High (3) - Slow load, poor UX, user frustration

**Description:**
- 10 card images loading simultaneously
- Sequential animation for 10 cards
- Multiple interpretation texts (long content)
- High memory usage

**Mitigation:**
- Progressive image loading
- Lazy load interpretations
- Optimize images (WebP, proper sizes)
- Animation performance testing

**Testing:** TC-7.1-100 to TC-7.1-105

---

### 4. BUS-001: Content Quality Below Premium Expectations

**Score: 6 (High)**  
**Probability:** Medium (2) - Subjective quality, 10 positions to write  
**Impact:** High (3) - Low user satisfaction, churn, no perceived value

**Description:**
Celtic Cross is flagship premium spread. Content must justify ฿199-399/month subscription. Risk of:
- Generic interpretations (not premium depth)
- Machine-translated Thai (not natural)
- Incorrect Tarot meanings
- Missing actionable guidance

**Mitigation:**
- Tarot expert writes/reviews all 10 positions
- Thai native speaker reviews language
- 100-200 words per position (depth requirement)
- User testing before launch (UAT)

**Testing:** Story 7.6 content QA, Story 7.9 UAT

---

### 5. TECH-002: Integration with Story 7.5 Layouts

**Score: 6 (High)**  
**Probability:** High (3) - Dependency on shared component  
**Impact:** Medium (2) - Delays, rework if layout component insufficient

**Description:**
Celtic Cross depends on Story 7.5 SpreadLayout component. Risk of:
- Layout component doesn't support cross + staff formation
- Props insufficient for 10-card complexity
- Performance issues with shared component

**Mitigation:**
- Story 7.5 completed BEFORE Story 7.1
- Layout component designed with Celtic Cross requirements
- Integration tests between 7.5 and 7.1

**Testing:** TC-7.5-120 to TC-7.5-122

---

## Medium Risks

### 6. DATA-001: Reading Save Fails with 10 Cards

**Score: 4 (Medium)**  
**Probability:** Medium (2) - Complex data structure  
**Impact:** Medium (2) - User loses reading, frustration

**Mitigation:**
- Database supports 10 cards (no constraint violations)
- Transaction ensures all-or-nothing save
- Error handling with retry

**Testing:** TC-7.1-080 to TC-7.1-086

---

### 7. PERF-002: Animation Janking

**Score: 4 (Medium)**  
**Probability:** Medium (2) - 10 sequential animations  
**Impact:** Medium (2) - Poor perceived quality

**Mitigation:**
- CSS animations (GPU accelerated)
- RequestAnimationFrame for JS animations
- Skip animation option

**Testing:** TC-7.1-030 to TC-7.1-036

---

### 8. OPS-001: Missing Monitoring

**Score: 4 (Medium)**  
**Probability:** Medium (2) - Often overlooked  
**Impact:** Medium (2) - Issues undetected

**Mitigation:**
- Analytics events: celtic_cross_viewed, completed
- Error tracking: Sentry for failures
- Performance monitoring: Page load, API response

**Testing:** Story 7.9 analytics verification

---

### 9. TECH-003: Cross-Browser Compatibility

**Score: 4 (Medium)**  
**Probability:** Medium (2) - CSS complexity  
**Impact:** Medium (2) - Some users can't use

**Mitigation:**
- Test on Chrome, Safari, Firefox, Edge
- CSS vendor prefixes
- Fallback styles

**Testing:** Story 7.9 browser testing matrix

---

### 10. DATA-002: Duplicate Card Selection

**Score: 4 (Medium)**  
**Probability:** Medium (2) - Shuffle algorithm edge case  
**Impact:** Medium (2) - Invalid reading, user confusion

**Mitigation:**
- Unique card validation in shuffle
- Unit tests for uniqueness

**Testing:** TC-7.1-040 to TC-7.1-045

---

## Low Risks

### 11. BUS-002: Low Adoption Rate

**Score: 3 (Low)**  
**Probability:** Low (1) - Celtic Cross is popular spread  
**Impact:** High (3) - Low ROI on development

**Mitigation:**
- Market research validates demand
- Prominent placement in UI
- Tutorial/guide for complex spread

---

### 12. OPS-002: Support Burden

**Score: 2 (Low)**  
**Probability:** Low (1) - Good UX should minimize confusion  
**Impact:** Medium (2) - Support team overhead

**Mitigation:**
- Clear instructions on page
- FAQ section
- Video tutorial (optional)

---

## Risk Matrix

| Risk ID | Description | Category | Probability | Impact | Score | Priority |
|---------|-------------|----------|-------------|--------|-------|----------|
| **SEC-001** | Unauthorized access bypass | Security | High (3) | High (3) | **9** | **CRITICAL** |
| **TECH-001** | Layout breaks on devices | Technical | High (3) | High (3) | **9** | **CRITICAL** |
| **PERF-001** | Performance with 10 cards | Performance | Medium (2) | High (3) | **6** | HIGH |
| **BUS-001** | Content quality insufficient | Business | Medium (2) | High (3) | **6** | HIGH |
| **TECH-002** | Layout component dependency | Technical | High (3) | Medium (2) | **6** | HIGH |
| **DATA-001** | Save fails with 10 cards | Data | Medium (2) | Medium (2) | **4** | MEDIUM |
| **PERF-002** | Animation janking | Performance | Medium (2) | Medium (2) | **4** | MEDIUM |
| **OPS-001** | Missing monitoring | Operational | Medium (2) | Medium (2) | **4** | MEDIUM |
| **TECH-003** | Browser compatibility | Technical | Medium (2) | Medium (2) | **4** | MEDIUM |
| **DATA-002** | Duplicate cards | Data | Medium (2) | Medium (2) | **4** | MEDIUM |
| **BUS-002** | Low adoption | Business | Low (1) | High (3) | **3** | LOW |
| **OPS-002** | Support burden | Operational | Low (1) | Medium (2) | **2** | LOW |

---

## Risk Distribution

### By Category
- **Security:** 1 risk (1 critical)
- **Technical:** 3 risks (1 critical, 1 high, 1 medium)
- **Performance:** 2 risks (1 high, 1 medium)
- **Data:** 2 risks (2 medium)
- **Business:** 2 risks (1 high, 1 low)
- **Operational:** 2 risks (1 medium, 1 low)

### By Severity
- **Critical (9):** 2 risks - MUST FIX
- **High (6):** 3 risks - SHOULD FIX
- **Medium (4):** 5 risks - CONSIDER FIX
- **Low (2-3):** 2 risks - MONITOR

---

## Risk-Based Testing Strategy

### Priority 1: Critical Risk Tests (P0)

**SEC-001 Mitigation Tests:**
- Access control all tier combinations (TC-7.1-001-007)
- Server-side validation tests
- Penetration testing attempts
- Grace period edge cases

**TECH-001 Mitigation Tests:**
- Device matrix testing (10+ devices)
- Layout tests all breakpoints
- Visual regression testing
- Performance on older devices

**Estimated Effort:** 2-3 days

---

### Priority 2: High Risk Tests (P1)

**PERF-001:** Performance testing suite (TC-7.1-100-105)  
**BUS-001:** Content QA (Story 7.6, manual review)  
**TECH-002:** Integration tests with Story 7.5 layouts

**Estimated Effort:** 2-3 days

---

### Priority 3: Medium/Low Risk Tests (P2)

- Standard functional tests
- Animation quality tests
- Analytics verification
- Browser compatibility

**Estimated Effort:** 1-2 days

---

## Risk Acceptance Criteria

### ❌ Must Fix Before Production

- **SEC-001:** Unauthorized access (Critical) - BLOCK PRODUCTION
- **TECH-001:** Layout breaks (Critical) - BLOCK PRODUCTION
- **PERF-001:** Performance degradation (High) - Must meet targets

### ⚠️ Can Deploy with Mitigation

- **BUS-001:** Content quality - If expert reviewed and UAT passed
- **TECH-002:** Layout dependency - If Story 7.5 tests pass
- Medium risks - If monitoring and error handling in place

### ✅ Accepted Risks

- **BUS-002:** Low adoption - Market risk, acceptable
- **OPS-002:** Support burden - Manageable with good UX

---

## Monitoring Requirements

### Post-Deployment Monitoring

**Security:**
- Alert on unauthorized access attempts (>5 per hour)
- Log all premium gate shows vs bypasses

**Performance:**
- Page load time (target <2s)
- API response time (target <300ms)
- Animation frame rate (target 60fps)

**Business:**
- Celtic Cross usage count
- Completion rate
- User satisfaction (feedback)
- Premium conversion from gate

**Operational:**
- Error rate (<1%)
- Support tickets tagged "Celtic Cross"

---

## Risk Mitigation Timeline

### Before Development (Story 7.5-7.6)
- [ ] Design review with security focus
- [ ] Layout component spec includes Celtic Cross requirements
- [ ] Content creation plan with expert review

### During Development (Story 7.1)
- [ ] Code review with focus on access control
- [ ] Unit tests for all critical paths
- [ ] Performance profiling with 10 cards

### Before Launch (Story 7.9)
- [ ] Comprehensive testing (all test cases)
- [ ] Security audit
- [ ] Device/browser testing
- [ ] UAT with real users

### After Launch (Story 7.10)
- [ ] Monitoring dashboard configured
- [ ] Team on standby first 24 hours
- [ ] Quick rollback plan ready

---

## Risk Review Triggers

Update risk profile if:
- Architecture changes (e.g., different layout approach)
- Security vulnerability discovered
- Performance issues reported in testing
- User feedback indicates problems
- Tier access rules change

---

## Recommendations

### Testing Priority

**P0 (Critical):**
1. Access control testing (all tiers, all scenarios)
2. Device/browser testing (10+ combinations)
3. Performance testing (10 cards load + animation)

**P1 (High):**
4. Content quality review (expert + user testing)
5. Integration testing (Story 7.5 layouts)

**P2 (Medium):**
6. Edge case testing
7. Analytics verification

### Development Focus

**Security:**
- Server-side tier validation (not just client)
- Middleware checks on route
- API endpoint authorization

**Performance:**
- Image optimization (WebP, responsive sizes)
- Progressive loading
- Animation optimization

**Quality:**
- Content expert review
- Thai language QA
- User acceptance testing

---

## For Gate File (risk_summary block)

```yaml
risk_summary:
  totals:
    critical: 2  # score 9
    high: 3      # score 6
    medium: 5    # score 4
    low: 2       # score 2-3
  highest:
    id: SEC-001
    score: 9
    title: 'Unauthorized premium access bypass'
    impact: 'Revenue loss - users access paid content without subscription'
    probability: 'High - complex access control with multiple edge cases'
  recommendations:
    must_fix:
      - 'Implement server-side tier validation in middleware and API'
      - 'Add comprehensive access control tests (all tier combinations)'
      - 'Device/browser testing matrix (10+ combinations)'
      - 'Performance testing with 10 cards (load time, animation)'
    monitor:
      - 'Unauthorized access attempts (alert on >5/hour)'
      - 'Page load times (alert if >2s p95)'
      - 'Celtic Cross usage and completion rates'
      - 'Error rates specific to Celtic Cross'
```

---

**Next Steps:**
1. Review risk profile with team
2. Prioritize mitigation actions
3. Include risk tests in test design (already done)
4. Execute mitigation before launch
5. Monitor post-launch

**Risk Owner:** Development Team + QA  
**Review Date:** Before Story 7.9 execution
