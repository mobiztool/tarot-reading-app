# Story 2.14: Performance & Security Optimization

## Status

**Approved**

---

## Story

**As a** developer,  
**I want** authentication to be fast and secure,  
**so that** users have a smooth experience and their data is protected.

---

## Acceptance Criteria

1. Auth state persistence: use secure HTTP-only cookies for token storage (more secure than localStorage)
2. Token refresh logic: automatically refresh access token before expiration
3. Session timeout: inactive users logged out after 30 days (configurable)
4. HTTPS enforced: all authentication endpoints use HTTPS in production
5. CORS properly configured: only allow requests from app domain
6. Rate limiting on auth endpoints: prevent brute force attacks (max 5 login attempts per 15 min)
7. Input sanitization: prevent SQL injection, XSS attacks on all form inputs
8. Password hashing: Supabase uses bcrypt (verify configuration)
9. Auth performance: login completes in <1 second, no noticeable delay
10. Error logging: all auth errors logged to Sentry for monitoring and debugging

---

## Tasks / Subtasks

- [ ] **Task 1: Cookie Configuration** (AC: 1)
  - [ ] Use HTTP-only cookies
  - [ ] Set secure flag for HTTPS
  - [ ] Configure SameSite attribute

- [ ] **Task 2: Token Refresh** (AC: 2)
  - [ ] Already handled by Supabase
  - [ ] Verify auto-refresh works
  - [ ] Test edge cases

- [ ] **Task 3: Session Timeout** (AC: 3)
  - [ ] Configure session duration
  - [ ] Test timeout behavior

- [ ] **Task 4: HTTPS Enforcement** (AC: 4)
  - [ ] Vercel enforces HTTPS automatically
  - [ ] Verify in production

- [ ] **Task 5: CORS Configuration** (AC: 5)
  - [ ] Configure allowed origins
  - [ ] Test from different domains

- [ ] **Task 6: Rate Limiting** (AC: 6)
  - [ ] Implement or verify Supabase rate limiting
  - [ ] Test with multiple failed attempts

- [ ] **Task 7: Input Sanitization** (AC: 7)
  - [ ] Use Zod validation (already implemented)
  - [ ] Sanitize inputs
  - [ ] Test XSS attacks

- [ ] **Task 8: Password Hashing** (AC: 8)
  - [ ] Verify Supabase uses bcrypt
  - [ ] Check configuration

- [ ] **Task 9: Performance Testing** (AC: 9)
  - [ ] Measure login time
  - [ ] Optimize if needed
  - [ ] Target: <1 second

- [ ] **Task 10: Error Logging** (AC: 10)
  - [ ] Integrate with Sentry (from Story 1.3)
  - [ ] Log all auth errors
  - [ ] Monitor error rates

- [ ] **Task 11: Testing** (AC: 1-10)
  - [ ] Security audit
  - [ ] Performance benchmarks
  - [ ] Penetration testing

---

## Dev Notes

**From Story 1.3:** Sentry already configured

**From Story 2.2:** Token refresh already working

This story hardens security and optimizes performance

---

## Change Log

| Date       | Version | Description            | Author           |
| ---------- | ------- | ---------------------- | ---------------- |
| 2026-01-01 | 1.0     | Initial story creation | Sarah (PO Agent) |
