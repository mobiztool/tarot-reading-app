# Story 2.11: Reading Permissions & Privacy

## Status

**Approved**

---

## Story

**As a** user,  
**I want** my readings to be private and secure,  
**so that** no one else can access my personal tarot reading history.

---

## Acceptance Criteria

1. Row Level Security (RLS) policies enabled on Supabase for `readings` and `users` tables
2. RLS policy: users can only SELECT, UPDATE, DELETE their own readings (`user_id = auth.uid()`)
3. Anonymous readings (user_id = NULL) readable by anyone with reading ID (if needed for sharing)
4. API routes validate authentication: return 401 Unauthorized for protected endpoints
5. Reading URLs: `/reading/[id]` checks ownership before displaying
6. Database queries: always filter by user_id when fetching readings
7. Security testing: attempt to access other user's reading â†’ receives 403 Forbidden
8. Privacy policy updated: explain data collection, storage, and user rights (PDPA compliance)
9. User data encryption: sensitive fields encrypted at rest (Supabase handles this)
10. No data leakage: error messages don't reveal information about other users

---

## Tasks / Subtasks

- [ ] **Task 1: Enable RLS on Tables** (AC: 1)
  - [ ] Already done in Story 2.5
  - [ ] Verify RLS policies active
  - [ ] Test with different users

- [ ] **Task 2: Implement API Auth Checks** (AC: 4)
  - [ ] Add auth validation to all protected routes
  - [ ] Return 401 for missing auth
  - [ ] Return 403 for unauthorized access

- [ ] **Task 3: Reading Ownership Check** (AC: 5, 6)
  - [ ] Verify user owns reading before display
  - [ ] Use RLS to enforce at database level
  - [ ] Add application-level checks as defense-in-depth

- [ ] **Task 4: Security Testing** (AC: 7)
  - [ ] Attempt to access other user's data
  - [ ] Verify blocked by RLS
  - [ ] Test with Postman/curl

- [ ] **Task 5: Privacy Policy** (AC: 8)
  - [ ] Update privacy page with PDPA-compliant content
  - [ ] Explain data collection and usage
  - [ ] User rights section

- [ ] **Task 6: Error Message Sanitization** (AC: 10)
  - [ ] Generic error messages
  - [ ] No data leakage in errors
  - [ ] Log details server-side only

- [ ] **Task 7: Testing** (AC: 1-10)
  - [ ] Security penetration testing
  - [ ] RLS policy testing
  - [ ] PDPA compliance check

---

## Dev Notes

**From Story 2.5:** RLS policies already implemented

This story validates and hardens security

---

## Change Log

| Date       | Version | Description            | Author           |
| ---------- | ------- | ---------------------- | ---------------- |
| 2026-01-01 | 1.0     | Initial story creation | Sarah (PO Agent) |
