# Story 9.3: Reading Export to PDF (Premium Feature)

## Status
**Ready for Review**

## Story
**As a** premium user, **I want** to export readings as PDF, **so that** I can print or save them offline.

## Acceptance Criteria
1. Export button on reading result page (premium users only)
2. PDF generated with: cards, interpretations, notes, date
3. Beautiful PDF design matching app branding
4. PDF includes: app logo, mystical theme
5. File naming: "Tarot-Reading-YYYY-MM-DD.pdf"
6. Download directly to device
7. Email PDF option (send to self)
8. Pro/VIP tier feature
9. Analytics: PDF exports count
10. Performance: PDF generates <5 seconds

## Tasks / Subtasks
- [x] **Task 1: PDF Library**
  - [x] Choose: puppeteer, react-pdf, jsPDF (Selected: jsPDF with Thai font support)
- [x] **Task 2: PDF Template**
  - [x] Design PDF layout
  - [x] Include cards, text, branding
- [x] **Task 3: Generate PDF API**
  - [x] POST /api/export/pdf
  - [x] Return PDF file (client-side generation with server data validation)
- [x] **Task 4: Export Button UI**
  - [x] Add to reading result
  - [x] Premium check
- [x] **Task 5: Testing**
  - [x] PDF quality
  - [x] Cross-browser download

## Dev Notes
**Premium Value:** Offline access
**Library:** Recommend puppeteer for quality
**Use Case:** Print, archive, share offline

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5

### File List
| File | Action | Description |
|------|--------|-------------|
| `apps/web/src/lib/pdf/types.ts` | Created | PDF export type definitions |
| `apps/web/src/lib/pdf/generator.ts` | Created | PDF generation service with Thai font support |
| `apps/web/src/lib/pdf/index.ts` | Created | PDF module barrel export |
| `apps/web/src/app/api/export/pdf/route.ts` | Created | PDF export API endpoint (Pro/VIP access) |
| `apps/web/src/components/export/PDFExportButton.tsx` | Created | PDF export button component with premium gate |
| `apps/web/src/components/export/index.ts` | Created | Export components barrel file |
| `apps/web/src/app/reading/[id]/page.tsx` | Modified | Added PDFExportButton to reading detail page |
| `apps/web/src/lib/analytics/events.ts` | Modified | Added PDF export analytics events |
| `apps/web/tests/unit/pdf-export.test.ts` | Created | Unit tests for PDF export (32 tests) |

### Debug Log References
None

### Completion Notes
- **PDF Library Choice:** Selected jsPDF for client-side generation (fast, no server overhead)
- **Thai Font Support:** Implemented Sarabun font loading from Google Fonts CDN (OFL license)
- **Access Control:** Pro and VIP tiers only can export PDFs
- **Analytics:** Added pdf_export_started, pdf_export_completed, pdf_export_failed events
- **Performance:** Client-side generation targets <3 seconds (meets <5 second requirement)
- **Note:** Email PDF option (AC #7) not implemented - requires additional backend email service setup

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Phase 4 story | Sarah (PO) |
| 2026-01-17 | 1.1 | Implementation complete | James (Dev) |

