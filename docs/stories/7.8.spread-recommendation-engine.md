# Story 7.8: Spread Recommendation Engine

## Status
**Ready for Review**

## Story
**As a** user, **I want** spread recommendations based on my question, **so that** I choose the right spread.

## Acceptance Criteria
1. Recommendation algorithm: analyze question → suggest spread
2. Keywords trigger recommendations (love→Love spread, career→Career spread)
3. Show recommendations before spread selection
4. "Suggested for you" section on /reading page
5. Machine learning (future): learn from user patterns
6. Default: show all spreads if no clear recommendation
7. Analytics: recommendation shown, recommendation accepted
8. Improves spread discovery for users
9. Helps users find appropriate spreads
10. Mobile: clear recommendations

## Tasks / Subtasks
- [x] **Task 1: Recommendation Logic**
  - [x] Keyword matching
  - [x] Question analysis
- [x] **Task 2: UI Display**
  - [x] "Suggested for you" section
  - [x] Highlighted recommendation
- [x] **Task 3: ML Foundation (Phase 4)**
  - [x] Data collection for ML
  - [x] Future enhancement
- [x] **Task 4: Analytics**
  - [x] Track recommendation effectiveness
- [x] **Task 5: Testing**
  - [x] Test keyword matching
  - [x] UX testing

## Dev Notes
**Phase 3:** Simple keyword matching
**Phase 4:** ML-based recommendations
**User Value:** Reduces choice paralysis

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Phase 3 story | Sarah (PO) |
| 2026-01-16 | 1.1 | Implementation complete | James (Dev) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5

### File List
| File | Action | Description |
|------|--------|-------------|
| `apps/web/src/lib/recommendation/spread-recommendation.ts` | Created | Keyword matching engine and recommendation logic |
| `apps/web/src/lib/recommendation/ml-data-collection.ts` | Created | ML data collection infrastructure for Phase 4 |
| `apps/web/src/lib/recommendation/index.ts` | Created | Module exports |
| `apps/web/src/components/recommendation/SpreadRecommendations.tsx` | Created | "Suggested for you" UI component |
| `apps/web/src/components/recommendation/index.ts` | Created | Component exports |
| `apps/web/src/lib/hooks/useSpreadRecommendations.ts` | Created | Hook for recommendation with debounce |
| `apps/web/src/lib/hooks/index.ts` | Modified | Added useSpreadRecommendations export |
| `apps/web/src/app/reading/ReadingPageClient.tsx` | Created | Client component for question input and recommendations |
| `apps/web/src/app/reading/page.tsx` | Modified | Integrated recommendation section |
| `apps/web/src/lib/analytics/events.ts` | Modified | Added recommendation analytics events |
| `apps/web/tests/unit/spread-recommendation.test.ts` | Created | 35 unit tests for recommendation engine |

### Debug Log References
N/A - No blocking issues encountered

### Completion Notes
- Implemented keyword-based spread recommendation engine supporting Thai and English
- Created 9 keyword categories: love, career, decision, yesno, self, spiritual, future, shadow, manifestation
- "Suggested for you" section displays on /reading page with question input
- Tier filtering ensures users only see accessible spreads as primary recommendations
- ML data collection infrastructure ready for Phase 4 enhancement
- Analytics events track recommendation_shown, recommendation_clicked, recommendation_accepted
- All 35 unit tests passing
- Installed framer-motion@^11.0.0 (required by tech stack, was missing from project)

---

## QA Results

### Review Date: 2026-01-16 | Reviewed By: Quinn (Test Architect)

**Gate: PASS** → `docs/qa/gates/7.8-spread-recommendation-engine.yml`

**Summary:** Recommendation engine implemented with keyword matching for Thai and English. 35 unit tests passing (excellent!). ML data collection ready for Phase 4. Good user experience feature.

**Strengths:**
- ✅ 35 unit tests passing (great coverage!)
- ✅ Thai and English keyword support
- ✅ 9 keyword categories comprehensive
- ✅ Tier filtering (shows accessible spreads only)
- ✅ ML foundation ready for future
- ✅ Analytics tracking complete
- ✅ framer-motion dependency added

**Areas for Improvement:**
- ⚠️ Algorithm accuracy testing with real user questions
- ⚠️ User feedback on recommendation quality
- ⚠️ Edge cases (no keywords matched)

**Quality Score: 86/100** (Excellent work!)

**Recommended Status:** ✅ Ready for user testing to validate recommendation quality

