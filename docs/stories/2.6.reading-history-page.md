# Story 2.6: Reading History Page

## Status

**Approved**

---

## Story

**As a** logged-in user,  
**I want** to see all my past readings in one place,  
**so that** I can review previous insights and track patterns over time.

---

## Acceptance Criteria

1. Reading History page (`/history`) created, accessible only to logged-in users
2. Displays list of all user's readings in reverse chronological order (newest first)
3. Each reading item shows: date, reading type (Daily/3-Card), question (if provided), thumbnail of first card
4. Pagination or infinite scroll: load 20 readings at a time for performance
5. Filter options: "All readings", "Daily readings", "3-Card spreads"
6. Date range filter: "Last 7 days", "Last 30 days", "All time"
7. Search functionality: search by question text (basic version)
8. Empty state: if no readings, show "You haven't done any readings yet" with CTA button
9. Clicking reading item navigates to reading detail page
10. Mobile responsive: list view optimized for mobile with swipe gestures (optional)
11. Loading state: skeleton screens while fetching readings
12. Analytics tracked: `history_viewed`, `history_filter_used`, `reading_reopened`

---

## Tasks / Subtasks

- [ ] **Task 1: Create History Page** (AC: 1)
  - [ ] Create `src/app/history/page.tsx`
  - [ ] Protected route (redirect to login if not authenticated)
  - [ ] Add metadata for SEO
  - [ ] Fetch user's readings from API

- [ ] **Task 2: Create API Endpoint** (AC: 2, 4)
  - [ ] Create `GET /api/readings` (already exists from Story 1.7, update it)
  - [ ] Add query params: limit, offset, reading_type, date_from, date_to
  - [ ] Return paginated results:
    ```typescript
    const { data: readings, total } = await prisma.reading.findMany({
      where: {
        user_id: user.id,
        reading_type: filters.type,
        created_at: { gte: filters.dateFrom, lte: filters.dateTo },
      },
      include: {
        reading_cards: {
          include: { card: true },
          take: 1, // Only first card for thumbnail
        },
      },
      orderBy: { created_at: 'desc' },
      take: limit,
      skip: offset,
    });
    ```

- [ ] **Task 3: Create Reading List Item Component** (AC: 3)
  - [ ] Create `src/components/history/ReadingListItem.tsx`
  - [ ] Display: date, type icon, question preview, card thumbnail
  - [ ] Click handler navigates to `/reading/[id]`
  - [ ] Hover effect on desktop

- [ ] **Task 4: Implement Pagination** (AC: 4)
  - [ ] Option A: Traditional pagination (page numbers)
  - [ ] Option B: Infinite scroll (load more on scroll)
  - [ ] Implement chosen option with proper UX

- [ ] **Task 5: Add Filters** (AC: 5, 6)
  - [ ] Filter by reading type: dropdown or tabs
  - [ ] Date range filter: buttons for common ranges + custom
  - [ ] Apply filters to API call
  - [ ] Show active filters with clear badges

- [ ] **Task 6: Search Functionality** (AC: 7)
  - [ ] Add search input
  - [ ] Search in question text
  - [ ] Debounce search input (500ms)
  - [ ] Update results as user types

- [ ] **Task 7: Empty State** (AC: 8)
  - [ ] Show when no readings found
  - [ ] Friendly message and illustration
  - [ ] CTA button: "Start your first reading"

- [ ] **Task 8: Loading States** (AC: 11)
  - [ ] Skeleton screens while loading
  - [ ] Loading spinner for pagination
  - [ ] Disable interactions during load

- [ ] **Task 9: Analytics** (AC: 12)
  - [ ] Track: `history_viewed`, `history_filter_used`, `reading_reopened`

- [ ] **Task 10: Testing** (AC: 1-12)
  - [ ] E2E test complete flow
  - [ ] Test filters and search
  - [ ] Test pagination

---

## Dev Notes

**From Story 2.5:** User-reading association ready, can query by user_id

**From Story 1.7-1.8:** Reading detail components reusable

---

## Change Log

| Date       | Version | Description            | Author           |
| ---------- | ------- | ---------------------- | ---------------- |
| 2026-01-01 | 1.0     | Initial story creation | Sarah (PO Agent) |
