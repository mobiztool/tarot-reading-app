# Story 2.12: User Analytics & Retention Metrics

## Status

**Approved**

---

## Story

**As a** product manager,  
**I want** to track user behavior and retention,  
**so that** we can measure the success of the authentication feature and optimize for growth.

---

## Acceptance Criteria

1. Analytics events implemented for all user actions: signup, login, logout, profile update
2. Cohort tracking: new users tagged by signup date for retention analysis
3. User properties in GA4: user_id (hashed), signup_method, account_age, readings_count
4. Funnel tracking: landing → signup prompt → signup → first reading as logged-in user
5. Retention metrics: track DAU (Daily Active Users), WAU, MAU for logged-in users
6. Engagement metrics: readings per user, days since last reading, reading frequency
7. Conversion rate: anonymous users → signed up users (%)
8. Privacy compliant: no PII (personally identifiable information) sent to analytics
9. Dashboard (future): Vercel Analytics or PostHog dashboard showing key metrics
10. A/B test ready: infrastructure to test different signup prompts or flows (foundation only)

---

## Tasks / Subtasks

- [ ] **Task 1: Implement User Events** (AC: 1)
  - [ ] Already partially done in previous stories
  - [ ] Verify all events tracked
  - [ ] Consistent event naming

- [ ] **Task 2: User Properties** (AC: 3)
  - [ ] Set user properties in GA4:
    ```typescript
    gtag('set', 'user_properties', {
      user_id: hashUserId(user.id),
      signup_method: user.auth_provider,
      account_age_days: calculateAccountAge(user.created_at),
      readings_count: user.readings.length,
    });
    ```

- [ ] **Task 3: Cohort Tagging** (AC: 2)
  - [ ] Tag users with signup date
  - [ ] Enable cohort analysis in GA4

- [ ] **Task 4: Funnel Setup** (AC: 4)
  - [ ] Define conversion funnel in GA4
  - [ ] Track each step
  - [ ] Monitor conversion rates

- [ ] **Task 5: Retention Metrics** (AC: 5, 6)
  - [ ] Track login frequency
  - [ ] Calculate DAU, WAU, MAU
  - [ ] Monitor reading frequency

- [ ] **Task 6: Privacy Compliance** (AC: 8)
  - [ ] Hash user IDs
  - [ ] No email addresses in analytics
  - [ ] No PII

- [ ] **Task 7: Testing** (AC: 1-10)
  - [ ] Verify events fire correctly
  - [ ] Check user properties set
  - [ ] Validate privacy compliance

---

## Dev Notes

**From Story 1.3:** Analytics infrastructure ready

**From previous Epic 2 stories:** Events already tracked

This story consolidates and enhances analytics

---

## Change Log

| Date       | Version | Description            | Author           |
| ---------- | ------- | ---------------------- | ---------------- |
| 2026-01-01 | 1.0     | Initial story creation | Sarah (PO Agent) |
